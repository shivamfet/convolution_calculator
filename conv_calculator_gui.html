<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Convolution Output Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 20px;
            padding: 30px;
        }

        .controls-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            height: fit-content;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid #667eea;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid #667eea;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .input-height::-webkit-slider-thumb { border-color: #3498db; }
        .filter-height::-webkit-slider-thumb { border-color: #e74c3c; }
        .stride-slider::-webkit-slider-thumb { border-color: #f39c12; }
        .padding-slider::-webkit-slider-thumb { border-color: #9b59b6; }

        .value-display {
            min-width: 50px;
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            text-align: center;
            font-weight: 700;
            font-size: 1.1em;
        }

        .input-value { background: #3498db; }
        .filter-value { background: #e74c3c; }
        .stride-value { background: #f39c12; }
        .padding-value { background: #9b59b6; }

        .separator {
            height: 2px;
            background: linear-gradient(to right, transparent, #ddd, transparent);
            margin: 25px 0;
        }

        .presets {
            margin-top: 30px;
        }

        .presets h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .preset-btn {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .preset-btn:hover {
            background: #2c3e50;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .visualization-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .canvas-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        canvas {
            width: 100%;
            height: 400px;
            border-radius: 10px;
        }

        .results-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .results-panel h2 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .formula-display {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 0.95em;
        }

        .result-box {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.3em;
            font-weight: 700;
            transition: all 0.3s;
        }

        .result-valid {
            background: #d4edda;
            color: #27ae60;
            border: 2px solid #27ae60;
        }

        .result-invalid {
            background: #f8d7da;
            color: #c0392b;
            border: 2px solid #c0392b;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Interactive Convolution Output Calculator</h1>
            <p>Visualize how input dimensions, filters, stride, and padding affect convolution output</p>
        </div>

        <div class="main-content">
            <!-- Controls Panel -->
            <div class="controls-panel">
                <div class="control-group">
                    <label>Input Height: <span id="inputHeightVal">64</span></label>
                    <div class="slider-container">
                        <input type="range" id="inputHeight" class="input-height" min="1" max="512" value="64">
                        <div class="value-display input-value" id="inputHeightDisplay">64</div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Input Width: <span id="inputWidthVal">64</span></label>
                    <div class="slider-container">
                        <input type="range" id="inputWidth" class="input-height" min="1" max="512" value="64">
                        <div class="value-display input-value" id="inputWidthDisplay">64</div>
                    </div>
                </div>

                <div class="separator"></div>

                <div class="control-group">
                    <label>Filter Height: <span id="filterHeightVal">3</span></label>
                    <div class="slider-container">
                        <input type="range" id="filterHeight" class="filter-height" min="1" max="15" value="3">
                        <div class="value-display filter-value" id="filterHeightDisplay">3</div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Filter Width: <span id="filterWidthVal">3</span></label>
                    <div class="slider-container">
                        <input type="range" id="filterWidth" class="filter-height" min="1" max="15" value="3">
                        <div class="value-display filter-value" id="filterWidthDisplay">3</div>
                    </div>
                </div>

                <div class="separator"></div>

                <div class="control-group">
                    <label>Stride: <span id="strideVal">1</span></label>
                    <div class="slider-container">
                        <input type="range" id="stride" class="stride-slider" min="1" max="8" value="1">
                        <div class="value-display stride-value" id="strideDisplay">1</div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Padding: <span id="paddingVal">1</span></label>
                    <div class="slider-container">
                        <input type="range" id="padding" class="padding-slider" min="0" max="10" value="1">
                        <div class="value-display padding-value" id="paddingDisplay">1</div>
                    </div>
                </div>

                <div class="presets">
                    <h3>üéØ Quick Presets</h3>
                    <button class="preset-btn" onclick="setPreset(28, 28, 5, 5, 1, 0)">MNIST 28√ó28</button>
                    <button class="preset-btn" onclick="setPreset(32, 32, 3, 3, 1, 1)">CIFAR 32√ó32</button>
                    <button class="preset-btn" onclick="setPreset(224, 224, 8, 8, 2, 3)">Large Image 224√ó224</button>
                    <button class="preset-btn" onclick="setPreset(64, 64, 3, 3, 2, 1)">Downsampling 64√ó64</button>
                </div>
            </div>

            <!-- Visualization Panel -->
            <div class="visualization-panel">
                <div class="canvas-container">
                    <canvas id="visualCanvas"></canvas>
                </div>

                <div class="results-panel">
                    <h2>üìä Calculation Results</h2>
                    <div class="formula-display" id="formulaDisplay"></div>
                    <div class="result-box" id="resultBox"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get all controls
        const inputHeight = document.getElementById('inputHeight');
        const inputWidth = document.getElementById('inputWidth');
        const filterHeight = document.getElementById('filterHeight');
        const filterWidth = document.getElementById('filterWidth');
        const stride = document.getElementById('stride');
        const padding = document.getElementById('padding');

        const canvas = document.getElementById('visualCanvas');
        const ctx = canvas.getContext('2d');

        // Set canvas size
        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            updateCalculation();
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Update displays
        function updateDisplays() {
            document.getElementById('inputHeightDisplay').textContent = inputHeight.value;
            document.getElementById('inputWidthDisplay').textContent = inputWidth.value;
            document.getElementById('filterHeightDisplay').textContent = filterHeight.value;
            document.getElementById('filterWidthDisplay').textContent = filterWidth.value;
            document.getElementById('strideDisplay').textContent = stride.value;
            document.getElementById('paddingDisplay').textContent = padding.value;
        }

        // Calculate output dimension
        function calculateOutput(input, filter, stride, padding) {
            return ((input - filter + 2 * padding) / stride) + 1;
        }

        // Update calculation
        function updateCalculation() {
            updateDisplays();

            const ih = parseInt(inputHeight.value);
            const iw = parseInt(inputWidth.value);
            const fh = parseInt(filterHeight.value);
            const fw = parseInt(filterWidth.value);
            const s = parseInt(stride.value);
            const p = parseInt(padding.value);

            const oh = calculateOutput(ih, fh, s, p);
            const ow = calculateOutput(iw, fw, s, p);

            const isValid = oh > 0 && ow > 0 && oh === Math.floor(oh) && ow === Math.floor(ow);

            // Update formula display
            const formulaHTML = `
                <strong>Formula:</strong> Output = ((Input - Filter + 2√óPadding) / Stride) + 1<br><br>
                <strong>Height Calculation:</strong><br>
                &nbsp;&nbsp;= ((${ih} - ${fh} + 2√ó${p}) / ${s}) + 1<br>
                &nbsp;&nbsp;= (${ih - fh + 2*p} / ${s}) + 1<br>
                &nbsp;&nbsp;= ${oh.toFixed(2)}<br><br>
                <strong>Width Calculation:</strong><br>
                &nbsp;&nbsp;= ((${iw} - ${fw} + 2√ó${p}) / ${s}) + 1<br>
                &nbsp;&nbsp;= (${iw - fw + 2*p} / ${s}) + 1<br>
                &nbsp;&nbsp;= ${ow.toFixed(2)}
            `;
            document.getElementById('formulaDisplay').innerHTML = formulaHTML;

            // Update result box
            const resultBox = document.getElementById('resultBox');
            if (isValid) {
                resultBox.className = 'result-box result-valid';
                resultBox.innerHTML = `‚úì Output Dimensions: ${Math.floor(oh)} √ó ${Math.floor(ow)}<br>
                                      Total Features: ${(Math.floor(oh) * Math.floor(ow)).toLocaleString()}`;
            } else {
                resultBox.className = 'result-box result-invalid';
                resultBox.innerHTML = `‚úó Output: ${oh.toFixed(2)} √ó ${ow.toFixed(2)}<br>
                                      INVALID - Dimensions must be integers!`;
            }

            // Draw visualization
            drawVisualization(ih, iw, fh, fw, s, p, oh, ow, isValid);
        }

        // Draw visualization
        function drawVisualization(ih, iw, fh, fw, s, p, oh, ow, isValid) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const maxDim = Math.max(ih, iw, isValid ? Math.max(oh, ow) : 0);
            const scale = Math.min(80, 150 / maxDim);

            const spacing = canvas.width / 4;
            const yCenter = canvas.height / 2;

            // Draw input
            const inputX = spacing / 2;
            const inputY = yCenter - (ih * scale) / 2;
            drawRect(ctx, inputX, inputY, iw * scale, ih * scale, '#3498db', `Input\n${ih}√ó${iw}`);

            // Draw padding
            if (p > 0) {
                const padScale = p * scale;
                ctx.setLineDash([5, 5]);
                ctx.strokeStyle = '#9b59b6';
                ctx.lineWidth = 3;
                ctx.strokeRect(
                    inputX - padScale, inputY - padScale,
                    iw * scale + 2 * padScale, ih * scale + 2 * padScale
                );
                ctx.setLineDash([]);

                ctx.fillStyle = '#9b59b6';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`Padding: ${p}`, inputX + iw * scale / 2, inputY - padScale - 10);
            }

            // Draw filter
            const filterX = spacing * 1.5;
            const filterY = yCenter - (fh * scale) / 2;
            drawRect(ctx, filterX, filterY, fw * scale, fh * scale, '#e74c3c', `Filter\n${fh}√ó${fw}`);

            // Draw stride indicator
            if (s > 1) {
                const strideY = filterY + fh * scale + 30;
                const arrowLen = s * scale * 2;

                ctx.strokeStyle = '#f39c12';
                ctx.fillStyle = '#f39c12';
                ctx.lineWidth = 3;

                // Arrow
                ctx.beginPath();
                ctx.moveTo(filterX, strideY);
                ctx.lineTo(filterX + arrowLen, strideY);
                ctx.stroke();

                // Arrowhead
                ctx.beginPath();
                ctx.moveTo(filterX + arrowLen, strideY);
                ctx.lineTo(filterX + arrowLen - 10, strideY - 5);
                ctx.lineTo(filterX + arrowLen - 10, strideY + 5);
                ctx.fill();

                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`Stride: ${s}`, filterX + arrowLen / 2, strideY - 10);
            }

            // Draw arrow to output
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('‚üπ', spacing * 2.5, yCenter);

            // Draw output
            if (isValid) {
                const outputX = spacing * 3;
                const outputY = yCenter - (oh * scale) / 2;
                drawRect(ctx, outputX, outputY, ow * scale, oh * scale, '#27ae60',
                        `Output\n${Math.floor(oh)}√ó${Math.floor(ow)}`);
            } else {
                const outputX = spacing * 3;
                ctx.fillStyle = '#c0392b';
                ctx.font = 'bold 18px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‚ùå', outputX, yCenter - 20);
                ctx.fillText('Invalid', outputX, yCenter + 10);
                ctx.fillText('Configuration', outputX, yCenter + 30);
            }
        }

        // Draw rectangle with label
        function drawRect(ctx, x, y, w, h, color, label) {
            // Rectangle
            ctx.fillStyle = color;
            ctx.fillRect(x, y, w, h);
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, w, h);

            // Label
            ctx.fillStyle = 'white';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            const lines = label.split('\n');
            const lineHeight = 18;
            const startY = y + h / 2 - (lines.length - 1) * lineHeight / 2;

            lines.forEach((line, i) => {
                ctx.fillText(line, x + w / 2, startY + i * lineHeight);
            });
        }

        // Set preset
        function setPreset(ih, iw, fh, fw, s, p) {
            inputHeight.value = ih;
            inputWidth.value = iw;
            filterHeight.value = fh;
            filterWidth.value = fw;
            stride.value = s;
            padding.value = p;
            updateCalculation();
        }

        // Add event listeners
        [inputHeight, inputWidth, filterHeight, filterWidth, stride, padding].forEach(control => {
            control.addEventListener('input', updateCalculation);
        });

        // Initial calculation
        updateCalculation();
    </script>
</body>
</html>
